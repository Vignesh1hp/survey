<div class="survey-form-wrap d-flex justify-content-center w-100">
  <div class="survey-container">
    <div
      class="d-flex flex-column flex-lg-row justify-content-between align-lg-items-center header-section p-sm-0 p-2"
    >
      <!-- Title -->
      <div class="form-heading mb-3 mb-lg-0">Create New Survey</div>
      <!-- Right side section -->
      <div class="d-flex flex-column flex-sm-row flex-wrap align-items-center">
        <span class="survey-information me-sm-4 mb-2 mb-sm-0">
          * This Survey Is For Coaches Only
        </span>
        <div class="d-flex justify-content-center flex-wrap gap-2">
          <button class="publish-btn">Preview</button> <button class="cancel-btn">Cancel</button>
          <button class="publish-btn">Publish</button>
        </div>
      </div>
    </div>
    <!-- <div class="form-heading">Create New Survey</div> -->
    <form class="survey-form" [formGroup]="surveyForm">
      <div class="row g-3">
        <div class="col-lg-4 col-md-6 col-12">
          <!-- select surevey Type -->
          <label for="surveyType" class="form-label">Select Survey Type</label>
          <tvsm-select
            #surveyType
            id="surveyType"
            [options]="survey_type"
            (selectionChange)="onSelectChange($event)"
          >
          </tvsm-select>
        </div>
        <div class="col-lg-4 col-md-6 col-12">
          <!-- select coach grp -->
          <label for="coach_group" class="form-label">Select Coach Group</label>
          <tvsm-dropdown
            [options]="coach_group"
            placeholder="Select"
            [searchable]="true"
            [multiple]="true"
            id="coach_group"
            [showCheckboxes]="true"
            [filterIcon]="false"
            searchPlaceholder="Search"
            [searchIconContent]="searchIcon"
            [arrowIconContent]="arrowIcon"
          ></tvsm-dropdown>
        </div>
      </div>
      <div>
        <!-- survey description -->
        <label for="description" class="form-label">Survey Description</label>
        <tvsm-textarea maxlength="250" name="description"> </tvsm-textarea>
      </div>
      <div>
        <!-- Email notification -->
        <label class="form-label d-block">Email Notification</label>
        <div class="form-check form-switch toggle-section mt-3">
          <input
            class="form-check-input pointer"
            type="checkbox"
            role="switch"
            id="email-notification"
            [checked]="isEmailEnabled"
            (change)="toggleEmailNotification()"
          />
          @if (isEmailEnabled) {
            <div class="d-flex column-gap-2 align-items-center">
              <select
                id="timing"
                class="form-select custom-timing-select"
                formControlName="timing"
                (change)="onSelectChangeTiming($event)"
              >
                <option value="" disabled selected>Select</option>
                <option *ngFor="let option of timing" [value]="option.label">
                  {{ option.label }}
                </option>
              </select>
              <div class="timing-text">before survey starts</div>
            </div>
          }
        </div>
      </div>
      <div>
        <!-- Add questions section -->
        <h1 class="form-label d-block">Add Questions</h1>
        @for (q of questions; track trackById(q, $index)) {
          <div class="question-card-wrapper mt-3">
            <!-- QUESTION TYPE -->
            <div class="question-type-section">
              <div
                class="d-flex align-items-start position-relative justify-content-between flex-column row-gap-3 flex-sm-row"
              >
                <div class="select-section">
                  <tvsm-select
                    [options]="question_type"
                    placeholder="Select Type"
                    (selectionChange)="onQuestionTypeChange(q, $event)"
                  ></tvsm-select>
                </div>

                <div class="d-flex align-items-center">
                  <!-- Default Answer Checkbox -->
                  <div class="d-flex align-items-center me-5" *ngIf="q.type === 'single'">
                    <input
                      type="checkbox"
                      class="default-answer-checkbox me-2"
                      [id]="'default-answer-' + q.id"
                      [checked]="q.defaultAnswerEnabled"
                      (change)="toggleDefaultAnswers(q)"
                    />
                    <label class="mb-0 pointer" [for]="'default-answer-' + q.id"
                      >Default Answers</label
                    >
                  </div>
                </div>
                <!-- Delete -->
                <div (click)="removeQuestion(q.id)" class="pointer position-absolute end-0 top-0">
                  <img src="./assets/images/delete.svg" width="20" height="20" />
                </div>
              </div>
            </div>
            <hr class="dashed" />
            <!-- QUESTION BODY -->
            <div class="add-question-section container-fluid m-0 p-0 mt-1">
              <div class="row align-items-center m-0 p-0">
                <!-- Number -->
                <div class="row align-items-center m-0 p-0 flex-nowrap">
                  <div class="col-auto m-0 p-0">
                    <div class="question-number">{{ q.id }}</div>
                  </div>

                  <div class="col m-0">
                    <tvsm-form-field-wrapper class="w-100">
                      <tvsm-input
                        class="w-100"
                        type="text"
                        placeholder="Enter your question"
                      ></tvsm-input>
                    </tvsm-form-field-wrapper>
                  </div>
                </div>

                <!--  ENTER OPTIONS (default disabled) -->
                @if (!q.defaultAnswerEnabled && q.type !== 'write') {
                  <div class="col-12 col-md-11 p-0 options-section">
                    <div class="enter-option-text">Enter Options</div>
                    <div class="options-field-section">
                      @for (opt of q.options; track $index; let i = $index; let last = $last) {
                        <div class="row align-items-center m-0 p-0 option-row g-2">
                          <!-- INPUT -->
                          <div class="col col-12 col-sm d-flex column-gap-2">
                            <!-- NUMBER -->
                            <div class="question-number text-lower">{{ opt.label }}</div>
                            <tvsm-form-field-wrapper class="w-100">
                              <tvsm-input
                                class="w-100"
                                type="text"
                                placeholder="Option {{ i + 1 }}"
                              ></tvsm-input>
                            </tvsm-form-field-wrapper>
                          </div>

                          <!-- ACTION BUTTONS -->
                          <div
                            class="col-auto col-12 col-sm-auto d-flex align-items-center icon-actions justify-content-sm-start justify-content-end"
                          >
                            @if (q.options.length > 2) {
                              <button
                                type="button"
                                class="btn-flag btn-flag--remove me-1 d-flex align-items-center justify-content-center"
                                (click)="removeOption(q, i)"
                              >
                                <i class="bi bi-dash-lg"></i>
                              </button>
                            }

                            @if (last && q.options.length < 5) {
                              <button
                                type="button"
                                class="btn-flag btn-flag--add d-flex align-items-center justify-content-center"
                                (click)="addOption(q)"
                              >
                                <i class="bi bi-plus-lg"></i>
                              </button>
                            }
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
                <!-- DEFAULT ANSWERS ENABLED (Single / Multiple) -->
                @if (q.defaultAnswerEnabled && q.type !== 'write') {
                  <div class="col-12 p-0 options-section-default">
                    <div
                      class="radio-options d-flex flex-md-row flex-wrap align-items-center justify-content-center justify-content-md-start"
                    >
                      @for (opt of defaultOptions; track opt.value) {
                        <label class="radio-item d-flex align-items-center">
                          <input
                            [type]="q.type === 'multiple' ? 'checkbox' : 'radio'"
                            [checked]="isOptionSelected(q, opt.label)"
                            (change)="onDefaultOptionSelect(q, opt.label, $event)"
                            [class.custom-checkbox]="q.type === 'multiple'"
                          />
                          <span>{{ opt.label }}</span>
                        </label>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
      <!-- Add question button -->
      <div class="d-flex justify-content-end">
        <button class="add-question-btn" (click)="addQuestion()">Add Question</button>
      </div>
    </form>
  </div>
</div>
